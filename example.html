<!doctype html>
<meta charset="utf-8">
<script src="build/build.js"></script>
<script>
    var Collection = require('karlbohlmark-observable-collection/index.js');
    var model = require('evented-model')
        .collection(Collection);
    
    var schema = {
        "type": "object",
        "id": "User",
        "properties": {
            "firstname": { 
                "type":"string"
            },
            "email": { 
                "type":"string"
            },
            "employer": {
                "type": { "$ref": "Company" }
            }
        }
    };

    var companySchema = {
        "type": "object",
        "properties": {
            "name": {
                "type": "string"
            }
        }
    }

    var Company = model('Company', companySchema );

    var User = model('User')
    .attr('firstname')
    .attr('email')
    .attr('employers', [Company]);


    User.prototype.introduce = function () {
        console.log('My name is', this.firstname)
    }

    var user = new User({
        firstname: 'John',
        employers: [{
            "name": "Connecta"
        }, {
            "name": "Acme"
        }]
    })

    user.changes()(function (change) {
        console.log(change)
    })

    user.on('change firstname', function (val)Â {
        this.introduce()
    });

    user.firstname = 'Karl';

    user.employers.move(0, 1)
    
</script>
